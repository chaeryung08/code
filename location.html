
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìœ„ì¹˜ ê¸°ëŠ¥ ë°ëª¨</title>
  <link rel="stylesheet" href="style-location.css" />
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha384-some-integrity"
    crossorigin=""
  />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif; margin: 12px; }
    h1 { margin: 0 0 8px 0; font-size: 20px; }
    #controls { margin-bottom: 8px; display:flex; gap:8px; flex-wrap:wrap; }
    button { padding:8px 12px; border-radius:8px; border:1px solid #ccc; background:#f7f7f7; cursor:pointer; }
    button:active{ transform:translateY(1px); }
    #info { margin-bottom:8px; white-space:pre-wrap; background:#fafafa; padding:8px; border-radius:8px; border:1px solid #eee; }
    #map { height: 60vh; min-height:300px; border-radius:8px; border:1px solid #ddd; }
    .small { font-size:13px; color:#666; }
  </style>
</head>
<body>
  <h1>ğŸ“ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</h1>
  <div id="controls">
    <button id="getPosBtn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button>
    <button id="watchBtn">ì‹¤ì‹œê°„ ì¶”ì  ì‹œì‘</button>
    <button id="stopWatchBtn" disabled>ì¶”ì  ì¤‘ì§€</button>
    <button id="copyBtn">ì¢Œí‘œ ë³µì‚¬</button>
  </div>

  <div id="info" class="small">ìœ„ì¹˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha384-some-integrity"
    crossorigin=""></script>

  <script>
    // ê¸°ë³¸ ë³€ìˆ˜
    let map = null;
    let marker = null;
    let watchId = null;
    const infoEl = document.getElementById('info');
    const getPosBtn = document.getElementById('getPosBtn');
    const watchBtn = document.getElementById('watchBtn');
    const stopWatchBtn = document.getElementById('stopWatchBtn');
    const copyBtn = document.getElementById('copyBtn');

    // ì§€ë„ ì´ˆê¸°í™” (ì´ˆê¸° ì¤‘ì‹¬: ì„¸ê³„ ì¤‘ì‹¬)
    function initMap() {
      map = L.map('map', { zoomControl: true }).setView([20, 0], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
    }

    // ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
    function showPosition(pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const acc = pos.coords.accuracy;
      const alt = pos.coords.altitude;
      const heading = pos.coords.heading;
      const speed = pos.coords.speed;
      const time = new Date(pos.timestamp).toLocaleString();

      infoEl.textContent =
        `ìœ„ë„: ${lat}\nê²½ë„: ${lon}\nì •í™•ë„(ë¯¸í„°): ${acc}\nê³ ë„: ${alt === null ? 'ì•Œ ìˆ˜ ì—†ìŒ' : alt}\në°©í–¥(heading): ${heading === null ? 'N/A' : heading}\nì†ë„(m/s): ${speed === null ? 'N/A' : speed}\nì¸¡ì •ì‹œê°: ${time}`;

      // ì§€ë„ì— í‘œì‹œ
      if (!map) initMap();
      map.setView([lat, lon], 16);
      if (marker) marker.setLatLng([lat, lon]);
      else marker = L.marker([lat, lon]).addTo(map).bindPopup('í˜„ì¬ ìœ„ì¹˜').openPopup();

      // ì •í™•ë„ ì› í‘œì‹œ
      if (pos.coords.accuracy) {
        // accuracy circle: remove previous if exists
        if (window._accuracyCircle) map.removeLayer(window._accuracyCircle);
        window._accuracyCircle = L.circle([lat, lon], { radius: pos.coords.accuracy }).addTo(map);
      }
    }

    // ì—ëŸ¬ ì²˜ë¦¬
    function handleError(err) {
      switch (err.code) {
        case err.PERMISSION_DENIED:
          infoEl.textContent = 'ì˜¤ë¥˜: ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆì–´. í˜ì´ì§€ ê¶Œí•œ ì„¤ì •ì„ í™•ì¸í•´.';
          break;
        case err.POSITION_UNAVAILABLE:
          infoEl.textContent = 'ì˜¤ë¥˜: ìœ„ì¹˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ì–´.';
          break;
        case err.TIMEOUT:
          infoEl.textContent = 'ì˜¤ë¥˜: ìš”ì²­ì´ ì‹œê°„ì´ˆê³¼ ë˜ì—ˆì–´.';
          break;
        default:
          infoEl.textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´: ' + err.message;
      }
    }

    // ë‹¨ë°œì„± ìœ„ì¹˜ ìš”ì²­
    function requestPosition() {
      if (!navigator.geolocation) {
        infoEl.textContent = 'ì´ ë¸Œë¼ìš°ì €ëŠ” Geolocationì„ ì§€ì›í•˜ì§€ ì•Šì•„.';
        return;
      }
      infoEl.textContent = 'ìœ„ì¹˜ ìš”ì²­ ì¤‘...';
      navigator.geolocation.getCurrentPosition(showPosition, handleError, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 10000
      });
    }

    // ì‹¤ì‹œê°„ ê°ì‹œ ì‹œì‘
    function startWatch() {
      if (!navigator.geolocation) {
        infoEl.textContent = 'ì´ ë¸Œë¼ìš°ì €ëŠ” Geolocationì„ ì§€ì›í•˜ì§€ ì•Šì•„.';
        return;
      }
      if (watchId !== null) return;
      watchId = navigator.geolocation.watchPosition(pos => {
        showPosition(pos);
        stopWatchBtn.disabled = false;
        watchBtn.disabled = true;
      }, handleError, {
        enableHighAccuracy: true,
        maximumAge: 2000,
        timeout: 10000
      });
      infoEl.textContent = 'ì‹¤ì‹œê°„ ì¶”ì ì„ ì‹œì‘í–ˆì–´. ê¶Œí•œì„ í™•ì¸í•´.';
    }

    // ê°ì‹œ ì¤‘ì§€
    function stopWatch() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
        watchBtn.disabled = false;
        stopWatchBtn.disabled = true;
        infoEl.textContent += '\nì¶”ì ì„ ì¤‘ì§€í–ˆì–´.';
      }
    }

    // ì¢Œí‘œ ë³µì‚¬
    async function copyCoords() {
      if (!marker) {
        alert('ë¨¼ì € ìœ„ì¹˜ë¥¼ ê°€ì ¸ì™€ì•¼ ì¢Œí‘œë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆì–´.');
        return;
      }
      const { lat, lng } = marker.getLatLng();
      const text = `${lat}, ${lng}`;
      try {
        await navigator.clipboard.writeText(text);
        alert('ì¢Œí‘œ ë³µì‚¬ë¨: ' + text);
      } catch (e) {
        alert('ë³µì‚¬ ì‹¤íŒ¨: ' + e);
      }
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    getPosBtn.addEventListener('click', requestPosition);
    watchBtn.addEventListener('click', startWatch);
    stopWatchBtn.addEventListener('click', stopWatch);
    copyBtn.addEventListener('click', copyCoords);

    // ì²« ë¡œë“œì— ì§€ë„ ì´ˆê¸°í™” (ì˜µì…˜)
    initMap();

    // í˜ì´ì§€ê°€ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì¸ì§€ ê²½ê³  (ì„ íƒì )
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
      const warn = '\nì£¼ì˜: ìœ„ì¹˜ ê¸°ëŠ¥ì€ HTTPS(ë˜ëŠ” localhost)ì—ì„œë§Œ ì œëŒ€ë¡œ ë™ì‘í•´. file://ë¡œ ì—´ë©´ ì•ˆ ë  ê°€ëŠ¥ì„±ì´ ë†’ì•„.';
      infoEl.textContent = warn + '\n' + infoEl.textContent;
    }
  </script>
</body>
</html>
